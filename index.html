<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rekap Tunggakan ULP Tulung</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root{
  --pln:#009FDA;
  --bg:#f6f8fa;
  --text:#111;
  --card:#fff;
}
[data-theme="dark"]{
  --bg:#121212;
  --text:#eee;
  --card:#1e1e1e;
}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
header{display:flex;gap:12px;align-items:center;padding:12px;border-bottom:3px solid var(--pln)}
header img{height:36px}
h1{font-size:1.2rem;margin:0;color:var(--pln)}
small{color:#666}
.tabs{display:flex;gap:6px;padding:10px}
.tab{padding:6px 12px;border-radius:8px;border:1px solid var(--pln);background:#fff;color:var(--pln);cursor:pointer}
.tab.active{background:var(--pln);color:#fff}
.toggle{margin-left:auto;background:#ffd100;border:none;padding:6px 10px;border-radius:6px}
.card{background:var(--card);margin:10px;border-radius:12px;overflow:auto}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #ddd}
th{background:#222;color:#fff}
tr.click:hover{background:#f1f1f1;cursor:pointer}
button.back{margin:10px;padding:6px 10px;border:none;border-radius:6px;background:var(--pln);color:#fff}
</style>
</head>

<body data-theme="light">

<header>
  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAABQCAYAAABg7xFvAAA..." alt="PLN">
  <div>
    <h1>Rekap Tunggakan</h1>
    <small>ULP Tulung</small>
  </div>
</header>

<div class="tabs">
  <div class="tab active" onclick="switchSheet('lembar1',this)">Lembar 1</div>
  <div class="tab" onclick="switchSheet('lembar2',this)">Lembar 2</div>
  <div class="tab" onclick="switchSheet('lembar3',this)">Lembar 3</div>
  <button class="toggle" onclick="toggleTheme()">ðŸŒ™</button>
</div>

<button class="back" onclick="goBack()" style="display:none">â¬… Kembali</button>

<div class="card">
  <table>
    <thead></thead>
    <tbody></tbody>
  </table>
</div>

<script>
const SHEETS={
  lembar1:"https://docs.google.com/spreadsheets/d/e/2PACX-1vR0oO36v0vrge07HwX1zLsrGfuUxElZ3becef4DFHLNxsz2Lrohya5oThpvmkjzsNBF3_9hSdq0q4Ko/pub?gid=354207978&single=true&output=csv",
  lembar2:"https://docs.google.com/spreadsheets/d/e/2PACX-1vR0oO36v0vrge07HwX1zLsrGfuUxElZ3becef4DFHLNxsz2Lrohya5oThpvmkjzsNBF3_9hSdq0q4Ko/pub?gid=311394824&single=true&output=csv",
  lembar3:"https://docs.google.com/spreadsheets/d/e/2PACX-1vR0oO36v0vrge07HwX1zLsrGfuUxElZ3becef4DFHLNxsz2Lrohya5oThpvmkjzsNBF3_9hSdq0q4Ko/pub?gid=654408403&single=true&output=csv"
};

let allData=[],currentLevel="petugas";

function toggleTheme(){
  document.body.dataset.theme =
    document.body.dataset.theme==="dark"?"light":"dark";
}

function switchSheet(s,el){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
  loadCSV(s);
}

async function loadCSV(sheet){
  const r=await fetch(SHEETS[sheet]);
  const t=await r.text();
  allData=Papa.parse(t,{header:true,skipEmptyLines:true}).data;
  renderPetugas();
}

function renderPetugas(){
  currentLevel="petugas";
  document.querySelector(".back").style.display="none";

  const rekap={};
  allData.forEach(r=>{
    const p=r.petugas||"TANPA PETUGAS";
    rekap[p]=(rekap[p]||0)+1;
  });

  const thead=document.querySelector("thead");
  const tbody=document.querySelector("tbody");
  thead.innerHTML="<tr><th>Petugas</th><th>Jumlah</th></tr>";

  let html=`<tr class="click" onclick="renderDetail('ALL')"><td><b>ALL</b></td><td><b>${allData.length}</b></td></tr>`;
  Object.keys(rekap).forEach(p=>{
    html+=`<tr class="click" onclick="renderDetail('${p}')"><td>${p}</td><td>${rekap[p]}</td></tr>`;
  });
  tbody.innerHTML=html;
}

function renderDetail(p){
  currentLevel="detail";
  document.querySelector(".back").style.display="block";

  const rows = p==="ALL" ? allData : allData.filter(r=>r.petugas===p);
  const cols=Object.keys(rows[0]||{});

  document.querySelector("thead").innerHTML =
    "<tr>"+cols.map(c=>`<th>${c}</th>`).join("")+"</tr>";
  document.querySelector("tbody").innerHTML =
    rows.map(r=>"<tr>"+cols.map(c=>`<td>${r[c]||""}</td>`).join("")+"</tr>").join("");
}

function goBack(){ renderPetugas(); }

loadCSV("lembar1");
</script>

</body>
</html>


