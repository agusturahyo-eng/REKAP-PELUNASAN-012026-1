<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rekap Tunggakan ULP Tulung</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --pln-blue:#009FDA;
  --pln-yellow:#FFD100;
  --bg:#f8f9fa;
  --text:#212529;
  --card:#ffffff;
}
[data-theme="dark"]{
  --bg:#121212;
  --text:#eaeaea;
  --card:#1e1e1e;
}

body{
  background:var(--bg);
  color:var(--text);
  padding:14px;
  font-family:system-ui;
}

.header{
  display:flex;
  align-items:center;
  gap:14px;
  border-bottom:3px solid var(--pln-blue);
  padding-bottom:10px;
  margin-bottom:16px;
}
.header img{height:42px}
.title h1{font-size:1.4rem;margin:0;color:var(--pln-blue)}
.title small{color:#6c757d}

.card-ui{
  background:var(--card);
  border-radius:14px;
  padding:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  margin-bottom:14px;
}

.nav-tabs .nav-link.active{
  background:var(--pln-blue);
  color:#fff;
  border:none;
}
.nav-tabs .nav-link{color:var(--pln-blue)}

.table th{
  cursor:pointer;
  background:#212529;
  color:#fff;
}

.badge-sort{
  font-size:.65rem;
  margin-left:4px;
}

.toggle{
  border:none;
  background:var(--pln-yellow);
  padding:6px 10px;
  border-radius:8px;
  font-size:.85rem;
}
</style>
</head>

<body data-theme="light">

<div class="header">
  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAABQCAYAAABg7xFvAAAACXBIWXMAAAsSAAALEgHS3X78AAAF6ElEQVR4nO2dX2wUVRjHf7N3d9c2gkGQhKjA..." alt="PLN">
  <div class="title">
    <h1>Rekap Tunggakan</h1>
    <small>ULP Tulung</small>
  </div>
</div>

<div class="d-flex justify-content-between mb-2">
  <ul class="nav nav-tabs">
    <li class="nav-item"><a class="nav-link active" onclick="switchSheet('lembar1')">Lembar 1</a></li>
    <li class="nav-item"><a class="nav-link" onclick="switchSheet('lembar2')">Lembar 2</a></li>
    <li class="nav-item"><a class="nav-link" onclick="switchSheet('lembar3')">Lembar 3</a></li>
  </ul>
  <button class="toggle" onclick="toggleTheme()">ðŸŒ™ Dark</button>
</div>

<div class="card-ui">
  <canvas id="chart"></canvas>
</div>

<div class="card-ui">
  <div class="table-responsive">
    <table class="table table-striped" id="table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const SHEETS={
  lembar1:"https://docs.google.com/spreadsheets/d/e/2PACX-1vR0oO36v0vrge07HwX1zLsrGfuUxElZ3becef4DFHLNxsz2Lrohya5oThpvmkjzsNBF3_9hSdq0q4Ko/pub?gid=354207978&single=true&output=csv",
  lembar2:"https://docs.google.com/spreadsheets/d/e/2PACX-1vR0oO36v0vrge07HwX1zLsrGfuUxElZ3becef4DFHLNxsz2Lrohya5oThpvmkjzsNBF3_9hSdq0q4Ko/pub?gid=311394824&single=true&output=csv",
  lembar3:"https://docs.google.com/spreadsheets/d/e/2PACX-1vR0oO36v0vrge07HwX1zLsrGfuUxElZ3becef4DFHLNxsz2Lrohya5oThpvmkjzsNBF3_9hSdq0q4Ko/pub?gid=654408403&single=true&output=csv"
};

let data=[],sortCol=null,sortAsc=true,chart;

function toggleTheme(){
  const b=document.body;
  b.dataset.theme=b.dataset.theme==="dark"?"light":"dark";
}

function switchSheet(s){
  document.querySelectorAll(".nav-link").forEach(n=>n.classList.remove("active"));
  event.target.classList.add("active");
  loadCSV(s);
}

async function loadCSV(sheet){
  const res=await fetch(SHEETS[sheet]);
  const csv=await res.text();
  const parsed=Papa.parse(csv,{header:true,skipEmptyLines:true});
  data=parsed.data;
  render();
}

function render(){
  const cols=Object.keys(data[0]||{});
  renderTable(cols,data);
  renderChart(data);
}

function renderTable(cols,rows){
  const thead=document.querySelector("#table thead");
  const tbody=document.querySelector("#table tbody");
  thead.innerHTML="<tr>"+cols.map(c=>`<th onclick="sortBy('${c}')">${c}</th>`).join("")+"</tr>";
  tbody.innerHTML=rows.map(r=>"<tr>"+cols.map(c=>`<td>${r[c]||""}</td>`).join("")+"</tr>").join("");
}

function sortBy(c){
  sortAsc = sortCol===c ? !sortAsc : true;
  sortCol=c;
  data.sort((a,b)=>(a[c]||"").localeCompare(b[c]||"",undefined,{numeric:true})*(sortAsc?1:-1));
  render();
}

function renderChart(rows){
  const count={};
  rows.forEach(r=>{
    const t=r.tgl_lunas||"LAINNYA";
    count[t]=(count[t]||0)+1;
  });
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{
      labels:Object.keys(count),
      datasets:[{
        label:"Jumlah",
        data:Object.values(count),
        backgroundColor:"#009FDA"
      }]
    },
    options:{responsive:true}
  });
}

loadCSV("lembar1");
</script>

</body>
</html>






